# CLAUDE.md

Guidelines for Claude Code when working with this repository.

## Project Overview

YouTube Publisher — автоматизированная публикация видео на YouTube по расписанию из Google Sheets.

Проект построен по Clean Architecture с жёсткими границами между слоями:
- domain/ — бизнес-логика
- ports/ — интерфейсы (ABC / Protocol)
- adapters/ — реализации внешних зависимостей
- app/ — CLI и dependency injection

## Architecture Rules (CRITICAL)

### Dependency Rules

**domain/** НЕ МОЖЕТ зависеть от:
- adapters/
- app/
- конкретных внешних API
- инфраструктурных библиотек

**domain/** может зависеть только от:
- стандартной библиотеки Python
- dataclasses, enum
- других модулей domain/

**ports/**:
- содержат только интерфейсы (ABC / Protocol)
- не содержат бизнес-логики

**adapters/**:
- реализуют интерфейсы из ports/
- используют модели из domain/

**app/**:
- выполняет wiring зависимостей
- знает обо всех слоях
- не содержит бизнес-логики

❗ Нарушение этих правил считается архитектурной ошибкой.

## Ports Pattern (обязательный процесс)

При добавлении новой внешней зависимости:

1. Определи интерфейс в ports/
2. Используй интерфейс в domain/
3. Реализуй адаптер в adapters/
4. Подключи реализацию в app/

## Testing Rules

- Domain тестируется ТОЛЬКО через порты (моки интерфейсов).
- Domain logic не мокается.
- В acceptance-тестах запрещены прямые изменения production-данных без reset-механизма.
- Если тест требует reset внешнего состояния — он обязан использовать скрипт reset.

## Idempotency & Safety

- Повторный запуск не должен создавать дубликаты.
- Задачи с заполненным youtube_video_id считаются обработанными.
- Временные ошибки допускают retry, постоянные — нет.

## AI Conversation Rules

- Обращайся на «ты»
- Без вежливо-формального тона
- Без мотивационных речей
- Фокус на анализе и фактах
- Не пиши комментарии в коде
